---
layout: page-with-sidebar
title:  "HBase"
date:   2023-10-28 10:47:03 +0800
author: reflectt6
categories: "大数据"
#permalink: 
mainTag: "大数据"
secondaryTag: ""
---





## PE

pe是hbase官方提供的一个测试工具，可以方便的创建测试数据集。

```shell
hbase pe --nomapred --oneCon=true --table=Tab_2G_write_20 --size=2 --valueSize=20 --columns=8 --presplit=10 --compress='SNAPPY' sequentialWrite 16
// 16线程 10个预分区 8个列 2G value长度为20 压缩方式为SNAPPY
```



## [官网资料](https://hbase.apache.org/apache_hbase_reference_guide.pdf)

学习hbase，当然首选官网了。官网有一版中文的资料，但是已经相当久了，只能图一乐。

看英文文档又非常痛苦，还好现在是AI的时代，chrom里装一个 `沉浸式翻译`插件就可以愉快的读native文档了。

### 架构

RegionServer管理着多个region，建议一个RegionServer管理region的数量不超过100个，因为假如一个RegionServer管理1000个region，那么就需要3.9G的MemStore空间，这还是啥都没存的情况下。（见72.1）

region又有以下结构（见72）

![image-20231120171009295](/assets/images/2023-10-28-HBase//image-20231120171009295.png)

一个Store存着0到多个StoreFile（HFile）（72.7）

这里辟个谣，StoreFile和Hfile是一个东西，很多资料里面说HFile属于StoreFile，这个是不准确的。而StoreFile/HFile里面是Block。

可以使用hbase hfile工具查看HFile信息, 可以通过以下命令查看工具用法

```shell
hbase hfile
```

打印如下：

```shell
usage: HFile [-a] [-b] [-e] [-f <arg> | -r <arg>] [-h] [-k] [-m] [-p]
       [-s] [-v] [-w <arg>]
 -a,--checkfamily         Enable family check
 -b,--printblocks         Print block index meta data
 -e,--printkey            Print keys
 -f,--file <arg>          File to scan. Pass full-path; e.g.
                          hdfs://a:9000/hbase/hbase:meta/12/34
 -h,--printblockheaders   Print block headers for each block.
 -k,--checkrow            Enable row order check; looks for out-of-order
                          keys
 -m,--printmeta           Print meta data of file
 -p,--printkv             Print key/value pairs
 -r,--region <arg>        Region to scan. Pass region name; e.g.
                          'hbase:meta,,1'
 -s,--stats               Print statistics
 -v,--verbose             Verbose output; emits file and meta data
                          delimiters
 -w,--seekToRow <arg>     Seek to this row and print all the kvs for this
                          row only
```

HFile中包含索引（见71.4.4）、bloom过滤器，以及实际的row

`An HFile is the file format that HBase uses to store data in HDFS. It contains a multi-layered
index which allows HBase to seek the data without having to read the whole file. `

关于HFile的详细介绍，可以看下[这一篇](https://www.iteye.com/blog/bit1129-2201094)

### Bloom过滤器

见124.4

存储在HFile的元数据中，下面的命令可以看到hfile的元数据，里面有Bloom Filter，也可以看到Block index的大小信息，

```shell
hbase hfile -m -f 【hfile的全路径】
```

