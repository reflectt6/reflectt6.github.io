---
layout: page-with-sidebar
title:  "编译问题"
date:   2024-04-26 9:47:03 +0800
author: reflectt6
categories: "C和C++"
mainTag: "编程基础"
secondaryTag: "C和C++"
hideTag: false
---

## 假如Java程序中加载native代码失败，可以从哪些方面排查

- 1、核对环境变量 LD_LIBRARY_PATH、LIBRARY_PATH

  `LD_LIBRARY_PATH` 和 `LIBRARY_PATH` 都是用于指定动态链接库（shared library）搜索路径的环境变量，但在使用上有一些区别。

  - `LD_LIBRARY_PATH`：程序在运行时会使用该环境变量指定的路径来搜索动态链接库。可以通过设置 `LD_LIBRARY_PATH` 来临时添加额外的库搜索路径，以便程序能够找到所需的共享库。例如：

    ```shell
    export LD_LIBRARY_PATH=/path/to/mylibs:$LD_LIBRARY_PATH
    ```

  - `LIBRARY_PATH`：用于指定编译器在编译时查找库文件的路径。编译器在编译过程中会搜索 `LIBRARY_PATH` 中指定的路径来查找所需的库文件。可以通过设置 `LIBRARY_PATH` 来告诉编译器在哪里查找库文件。例如：

    ```shell
    export LIBRARY_PATH=/path/to/mylibs:$LIBRARY_PATH
    ```

  需要注意的是，`LD_LIBRARY_PATH` 主要用于程序运行时查找动态链接库，而 `LIBRARY_PATH` 主要用于编译时查找库文件。在实际使用中，应根据具体情况来设置这两个环境变量，以确保程序能够正确地链接和运行。

- 2、查看共享库依赖关系

`ldd -r *.so` 是一个 Linux 下查看共享库依赖关系并检查是否存在未解决符号的命令。在这个命令中：

- `ldd` 是用于打印程序或共享库的动态链接器依赖关系的命令。
- `-r` 选项表示要打印出程序或库文件的依赖关系，同时检查是否存在未解决的符号。
- `*.so` 表示当前目录下所有的共享库文件（以 .so 结尾的文件）。

执行这个命令时，系统会列出每个共享库文件的依赖关系，并检查是否有未解决的符号（即缺少的符号定义）。如果有未解决的符号，可能会导致程序在运行时无法找到所需的函数或变量，从而导致程序运行失败。

- 3、Java调C++库，通常会将so文件打包到jar包中，检查so文件是否存在，如果so文件不存在就是在编译jar包时缺失了nativa的库



## 如何确认一个so文件是debug版本还是release版本

要确定一个共享对象文件（`.so`文件）是调试版本（debug）还是发布版本（release），可以通过以下几种方法：

### 1. 使用 `file` 命令

`file` 命令可以显示文件类型和一些基本信息。调试版本的共享对象文件通常包含调试符号。

```bash
file <filename>.so
```

如果是调试版本，输出中通常会包含 "with debug_info" 或类似的信息。

### 2. 使用 `readelf` 查看调试信息

你可以使用 `readelf` 工具查看共享对象文件是否包含调试信息段（例如 `.debug_info`）。

```bash
readelf -S <filename>.so | grep debug
```

如果输出包含类似 `.debug_info` 或 `.debug_str` 之类的段名，则该文件很可能是调试版本。

### 3. 使用 `nm` 或 `objdump` 查看符号表

调试版本的共享对象文件通常会包含未剥离的符号表，可以使用 `nm` 或 `objdump` 来检查。

使用 `nm`：

```bash
nm <filename>.so | less
```

使用 `objdump`：

```bash
objdump -t <filename>.so | less
```

如果输出中包含很多符号，尤其是以 `_debug` 或类似名称结尾的符号，则该文件可能是调试版本。

### 4. 使用 `gdb` 检查调试符号

你可以使用 `gdb`（GNU调试器）来检查共享对象文件是否包含调试信息。

```shell
gdb <filename>.so
```

在 `gdb` 中输入以下命令：

```shell
info functions
```

如果看到大量的函数名和调试信息，则该文件可能是调试版本。

### 示例

假设我们有一个名为 `libexample.so` 的共享对象文件。我们可以使用上述方法进行检查：

1. 使用 `file` 命令：

   ```bash
   file libexample.so
   ```

   输出示例：

   ```bash
   libexample.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, with debug_info, not stripped
   ```

2. 使用 `readelf` 命令：

   ```bash
   readelf -S libexample.so | grep debug
   ```

   输出示例：

   ```bash
   [25] .debug_info        PROGBITS        0000000000000000  0001234 0005678 00      0   0  1
   [26] .debug_abbrev      PROGBITS        0000000000000000  00068ac 0001234 00      0   0  1
   ```

3. 使用 `nm` 命令：使用 nm 命令：

   ```bash
   nm libexample.so | less
   ```

   如果输出包含大量的符号，并且有 `_debug` 或类似的符号，则该文件可能是调试版本。

通过上述方法，你可以确定一个 `.so` 文件是调试版本还是发布版本。







